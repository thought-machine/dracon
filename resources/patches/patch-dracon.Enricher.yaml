---
- op: replace
  path: /apiVersion
  value: tekton.dev/v1beta1
- op: replace
  path: /kind
  value: Task

- op: add
  path: /metadata/labels/project
  value: dracon

- op: add
  path: /spec/resources/outputs/-
  value: {name: enricher, type: storage}

- op: add
  path: /spec/steps/0
  value:
    name: setup-permissions
    image: busybox:latest
    command: ["chown"]
    args: ["-R", "1000:1000", "/workspace/output/enricher"]


{{ $producers := .PipelineTaskProducers }}
{{range $p := $producers}}
- op: add
  path: /spec/resources/inputs/-
  value: {name: {{$p.Name}}-producer, type: storage}
{{end}}
