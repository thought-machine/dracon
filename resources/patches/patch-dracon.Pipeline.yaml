---
- op: replace
  path: /apiVersion
  value: tekton.dev/v1beta1

- op: add
  path: /metadata/labels/project
  value: dracon

# Add workspace
- op: add
  path: /spec/workspaces
  value: [{name: "dracon"}]

{{ $pipelineParams := .PipelineParams}}
{{ $enrichers := .PipelineTaskEnrichers }}
{{ $producers := .PipelineTaskProducers }}
{{ $consumers := .PipelineTaskConsumers }}

{{range $pp := $pipelineParams}}
- op: add
  path: /spec/params/-
  value: {name: {{$pp.Name}}, description: "{{$pp.Description}}", type: {{$pp.Type}}}
{{end}}

# Enrichers
{{range $e := $enrichers}}
- op: add
  path: /spec/tasks/{{$e.Index}}/workspaces
  value: [{name: "dracon", workspace: "dracon"}]
{{end}}

{{range $p := $producers}}
- op: add
  path: /spec/tasks/{{$p.Index}}/workspaces
  value: [{name: "dracon", workspace: "dracon"}]
{{end}}

# Consumers
{{range $c := $consumers}}
- op: add
  path: /spec/tasks/{{$c.Index}}/workspaces
  value: [{name: "dracon", workspace: "dracon"}]

# {{range $pp := $pipelineParams}}
# - op: add
#   path: /spec/tasks/{{$c.Index}}/params/-
#   value: {name: {{$pp.Name}}, value: $(params.{{$pp.Name}})}
# {{end}}
{{end}}
